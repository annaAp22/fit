{"version":3,"sources":["filters.js","map.js","app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["$(function() {\r\n    var $filters = $('#js-filters'),\r\n        $sorters = $('.js-sort'),\r\n        $page = $filters.find('input[name=page]'),\r\n        $productsCount = $('.js-goods-count'),\r\n        $items = $('#js-goods'),\r\n        $paginator = $('.js-pagination'),\r\n        dontTouchThis = [\r\n            'page',\r\n            '_token',\r\n            'category_id',\r\n            'brand_id',\r\n            'tag_id',\r\n            'price_from',\r\n            'price_to'\r\n        ],\r\n        dontTouchSelector = '',\r\n        resetPagination = function(submit) {\r\n            if(typeof submit === 'undefined')\r\n                submit = false;\r\n            //console.log('reset pagination');\r\n            $page.val(1);\r\n            if(submit) {\r\n                $filters.trigger('submit');\r\n            }\r\n        },\r\n        // Reset filters values\r\n        resetFilters = function() {\r\n            $filters.find('input[type=checkbox]', 'input[type=radio]').attr('checked', false);\r\n            $filters.find('input[name^=attribute]').attr('disabled', true);\r\n            $('.js-square').removeClass('active');\r\n            rangeSlider.noUiSlider.set([rRange[0], rRange[1]]);\r\n\r\n            resetPagination(true);\r\n        };\r\n\r\n    for(var index in dontTouchThis)\r\n        dontTouchSelector += '[name!=' + dontTouchThis[index] + ']';\r\n\r\n    if($page.val() == '') $paginator.hide();\r\n\r\n    // Price range slider init\r\n    var rangeSlider = document.getElementById('js-range-slider');\r\n    if( rangeSlider ) {\r\n        var $this = $(rangeSlider);\r\n        rStart = $this.data('start'),\r\n            rRange = $this.data('range');\r\n\r\n        noUiSlider.create(rangeSlider, {\r\n            start: [ rStart[0], rStart[1] ],\r\n            connect: true,\r\n            range: {\r\n                'min': rRange[0],\r\n                'max': rRange[1]\r\n            }\r\n        });\r\n\r\n        var priceMin = document.getElementById('js-price-min'),\r\n            priceMax = document.getElementById('js-price-max');\r\n\r\n        rangeSlider.noUiSlider.on('update', function( values, handle ) {\r\n\r\n            var value = values[handle];\r\n\r\n            if ( handle ) {\r\n                priceMax.value = Math.round(value);\r\n            } else {\r\n                priceMin.value = Math.round(value);\r\n            }\r\n        });\r\n\r\n        rangeSlider.noUiSlider.on('set', function(){\r\n            resetPagination();\r\n        });\r\n\r\n        priceMin.addEventListener('change', function(){\r\n            rangeSlider.noUiSlider.set([this.value, null]);\r\n        });\r\n        priceMax.addEventListener('change', function(){\r\n            rangeSlider.noUiSlider.set([null, this.value]);\r\n        });\r\n    }\r\n\r\n    $filters.find('input[name^=attribute],select[name^=attribute]').on('change', function(e) {\r\n        e.preventDefault();\r\n        resetPagination();\r\n    });\r\n    $filters.find('.js-square').on('click', function(e) {\r\n        resetPagination();\r\n    });\r\n\r\n    $filters.on('submit', function(e) {\r\n        e.preventDefault();\r\n        var formData = $(this).serialize();\r\n        console.log(formData);\r\n        $.post($(this).attr('action'), formData, function(data) {\r\n            if(data.clear) {\r\n                $page.val(2);\r\n                $items.html($(data.items));\r\n            } else {\r\n                if($page.val() == 'all') {\r\n                    $items.html($(data.items));\r\n                }\r\n                else {\r\n                    $items.append($(data.items));\r\n                }\r\n            }\r\n\r\n            if(data.next_page === null) {\r\n                $paginator.hide();\r\n            }\r\n            else {\r\n                $paginator.show();\r\n                $page.val(data.next_page);\r\n            }\r\n            $productsCount.html(data.count);\r\n        });\r\n    });\r\n    $sorters.on('click', function(e) {\r\n        e.preventDefault();\r\n        var sort = $(this).data('sort');\r\n        $filters.find(\"input[name=sort]\").val(sort);\r\n\r\n        if($(this).hasClass('active')) {\r\n            $(this).removeClass('active');\r\n            //$filters.find('input[type=hidden]' + dontTouchSelector).val('');\r\n        } else {\r\n            $sorters.removeClass('active');\r\n            $(this).addClass('active');\r\n\r\n            //$filters.find('input[type=hidden]' + dontTouchSelector).val('');\r\n            //$filters.find('input[type=hidden][name=' + $(this).attr('name') + ']').val($(this).val());\r\n        }\r\n\r\n        resetPagination(true);\r\n    });\r\n\r\n    $paginator.on('click', function(e) {\r\n        e.preventDefault();\r\n        var showAll = $(this).data('all');\r\n        if(typeof showAll !== 'undefined' && showAll) {\r\n            $page.val('all');\r\n        }\r\n        console.log('get next page');\r\n        $filters.trigger('submit');\r\n    });\r\n\r\n    $(\".js-filters-reset\").on('click', function(e) {\r\n        e.preventDefault();\r\n        resetFilters();\r\n        $('.js-toggle-sidebar.active').trigger('click');\r\n        return false;\r\n    });\r\n    $(\".js-close-filters\").on('click', function(){\r\n        $('.js-toggle-sidebar.active').trigger('click');\r\n    });\r\n});","var mapDiv = document.getElementById('map');\r\nvar mapLoad = function(e) {\r\n    mapDiv.removeEventListener('click', mapLoad);\r\n    $.getScript( \"https://maps.googleapis.com/maps/api/js?key=AIzaSyBIc5obn1ArfkEzXhkgZiMyyHPRQmjNx5M\", function() {\r\n        init();\r\n    });\r\n};\r\nmapDiv.addEventListener('click', mapLoad);\r\n\r\n\r\n// When the window has finished loading create our google map below\r\n//google.maps.event.addDomListener(window, 'load', init);\r\n\r\nfunction init() {\r\n    // Basic options for a simple Google Map\r\n    // For more options see: https://developers.google.com/maps/documentation/javascript/reference#MapOptions\r\n    var mapOptions = {\r\n        // How zoomed in you want the map to start at (always required)\r\n        zoom: 15,\r\n\r\n        // The latitude and longitude to center the map (always required)\r\n        center: new google.maps.LatLng(55.711354, 37.654629), /* Moscow*/\r\n\r\n        // Do not change zoom on mouse scroll\r\n        scrollwheel: false,\r\n\r\n        // How you would like to style the map.\r\n        // This is where you would paste any style found on Snazzy Maps.\r\n        styles: [\r\n            {\r\n                \"featureType\": \"water\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#e9e9e9\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 17\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"landscape\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#f5f5f5\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 20\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.highway\",\r\n                \"elementType\": \"geometry.fill\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#ffffff\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 17\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.highway\",\r\n                \"elementType\": \"geometry.stroke\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#ffffff\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 29\r\n                    },\r\n                    {\r\n                        \"weight\": 0.2\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.arterial\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#ffffff\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 18\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"road.local\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#ffffff\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 16\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"poi\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#f5f5f5\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 21\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"poi.park\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#dedede\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 21\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"elementType\": \"labels.text.stroke\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"on\"\r\n                    },\r\n                    {\r\n                        \"color\": \"#ffffff\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 16\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"elementType\": \"labels.text.fill\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"saturation\": 36\r\n                    },\r\n                    {\r\n                        \"color\": \"#333333\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 40\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"elementType\": \"labels.icon\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"visibility\": \"off\"\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"transit\",\r\n                \"elementType\": \"geometry\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#f2f2f2\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 19\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"administrative\",\r\n                \"elementType\": \"geometry.fill\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#fefefe\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 20\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                \"featureType\": \"administrative\",\r\n                \"elementType\": \"geometry.stroke\",\r\n                \"stylers\": [\r\n                    {\r\n                        \"color\": \"#fefefe\"\r\n                    },\r\n                    {\r\n                        \"lightness\": 17\r\n                    },\r\n                    {\r\n                        \"weight\": 1.2\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    };\r\n\r\n    // Get the HTML DOM element that will contain your map\r\n    // We are using a div with id=\"map\" seen below in the <body>\r\n    var mapElement = document.getElementById('map');\r\n\r\n    // Create the Google Map using our element and options defined above\r\n    var map = new google.maps.Map(mapElement, mapOptions);\r\n\r\n    // Let's also add a marker while we're at it\r\n    var marker = new google.maps.Marker({\r\n        position: new google.maps.LatLng(55.710074, 37.654759),\r\n        map: map,\r\n        title: 'Магазин',\r\n        icon: \"/img/map_point-min.png\"\r\n    });\r\n\r\n    // center map on window resize\r\n    google.maps.event.addDomListener(window, \"resize\", function() {\r\n        var center = map.getCenter();\r\n        google.maps.event.trigger(map, \"resize\");\r\n        map.setCenter(center);\r\n    });\r\n}","$(function(){\r\n    var $body = $('body');\r\n\r\n    $body.on('click', '.js-close', function(e) {\r\n        $(this).hide();\r\n    })\r\n    $body.on('click', '.js-close-modal', function(e) {\r\n        $(this).closest('.modal').hide();\r\n    })\r\n\r\n    // Toggle active class\r\n    $body.on(\"click\", \".js-toggle-active\", function(e){\r\n        var $this = $(this),\r\n            reset = $this.data('reset');\r\n        if($this.hasClass(\".js-prevent-default\"))\r\n            e.preventDefault();\r\n        // Remove active class\r\n        if(typeof reset !== 'undefined') {\r\n            $(reset).removeClass(\"active\")\r\n        }\r\n\r\n        $this.toggleClass('active');\r\n    });\r\n\r\n    //Prevent default for hovered elements\r\n    $body.on(\"click\", \".js-prevent\", function(e){\r\n        e.preventDefault();\r\n        return false;\r\n    });\r\n\r\n    // Square check filter (size, color)\r\n    var squareCheckFilter = $('.js-square-check-filter');\r\n    if( squareCheckFilter ) {\r\n        $body.on(\"click\", \".js-square\", function(){\r\n            var square = $(this),\r\n                parent = square.parent(),\r\n                single = false;\r\n\r\n            // if single checked needed then reset all checkboxes\r\n            if(parent.hasClass(\"js-square-check-single\")) {\r\n                single = true;\r\n            }\r\n\r\n            if( square.hasClass(\"active\") ) {\r\n                if(single) {\r\n                    removeActiveSquares(parent);\r\n                }\r\n                else {\r\n                    square.removeClass(\"active\");\r\n                    square.find(\"input\").attr(\"disabled\", true);\r\n                }\r\n            }\r\n            else {\r\n                if(single) {\r\n                    removeActiveSquares(parent);\r\n                }\r\n                square.addClass(\"active\");\r\n                square.find(\"input\").attr(\"disabled\", null);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Remove active class from all squares\r\n    function removeActiveSquares(parent) {\r\n        parent.find(\".active\").each(function(){\r\n            $(this).removeClass(\"active\");\r\n            $(this).find(\"input\").attr(\"disabled\", true);\r\n        });\r\n    }\r\n\r\n    // Show more info in some container\r\n    $body.on(\"click\", \".js-show-more\", function(e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        $this.toggleClass(\"active\");\r\n        $this.parent().toggleClass(\"active\");\r\n    });\r\n\r\n    // Select behaviour emulation\r\n    $body.on(\"click\", \".js-select\", function(){\r\n        var select = $(this);\r\n        select.find(\".js-option\").click(function(){\r\n            select.find(\".js-selected\").text($(this).text());\r\n        });\r\n    });\r\n\r\n    // Toggle target active class on click\r\n    $body.on(\"click\", \".js-toggle-active-target\", function(e){\r\n        e.preventDefault();\r\n        toggleActiveTarget($(this));\r\n    });\r\n\r\n    // Toggle target active class on mouse over\r\n    $body.on(\"mouseenter\", \".js-toggle-active-target_over\", function(){\r\n        if( !$(this).hasClass('active'))\r\n            toggleActiveTarget($(this));\r\n    });\r\n\r\n    function toggleActiveTarget($this) {\r\n        var target = $this.data('target'),\r\n            switchN = $this.data('switch'),\r\n            reset = $this.data('reset');\r\n\r\n        // toggle switch if needed\r\n        if(typeof switchN !== 'undefined') {\r\n            $(\"[data-switch=\"+switchN+\"]\").toggleClass(\"active\");\r\n        }\r\n        // remove active from all elements\r\n        else if(typeof reset !== 'undefined') {\r\n            $(reset).removeClass(\"active\")\r\n        }\r\n        else {\r\n            $this.toggleClass(\"active\");\r\n        }\r\n\r\n        $(target).toggleClass(\"active\");\r\n    }\r\n\r\n    // Show notice popup on element hover\r\n    $body.on(\"mouseover\", \".js-hover-notice\", function() {\r\n        $(this).find(\".popup-notice\").addClass('active');\r\n    });\r\n    $body.on(\"mouseout\", \".js-hover-notice\", function() {\r\n        $(this).find(\".popup-notice\").removeClass('active');\r\n    });\r\n\r\n    // Show notice popup on element click (not used yet)\r\n    $body.on(\"click\", \".js-click-notice\", function() {\r\n        var target = $(this).data(\"target\"),\r\n            popup;\r\n        if(typeof target !== \"undefined\") {\r\n            popup = $(this).closest(\".popup-notice_\" + target);\r\n        }\r\n        else {\r\n            popup = $(this).find(\".popup-notice\");\r\n        }\r\n        popup.addClass('active');\r\n        setTimeout(function(){\r\n            popup.removeClass('active');\r\n        }, 6000);\r\n    });\r\n\r\n    // Add to cart\r\n    $body.on(\"click\", \".js-add-to-cart\", function(e) {\r\n        e.preventDefault();\r\n        var $this = $(this);\r\n        if( !$(this).hasClass('active') ) {\r\n            var form = $this.closest('form'),\r\n                data = form.serializeFormJSON();\r\n            if(typeof data.size === \"undefined\") {\r\n                var size = form.find(\".js-popup-size\");\r\n                size.addClass('active');\r\n                setTimeout(function(){\r\n                    size.removeClass('active');\r\n                }, 3000);\r\n            }\r\n            else {\r\n                form.submit();\r\n                $this.addClass('active');\r\n            }\r\n        }\r\n        else {\r\n            window.location = $this.find('a').attr('href');\r\n        }\r\n    });\r\n\r\n    // Form serialize as json\r\n    $.fn.serializeFormJSON = function () {\r\n\r\n        var o = {};\r\n        var a = this.serializeArray();\r\n        $.each(a, function () {\r\n            if (o[this.name]) {\r\n                if (!o[this.name].push) {\r\n                    o[this.name] = [o[this.name]];\r\n                }\r\n                o[this.name].push(this.value || '');\r\n            } else {\r\n                o[this.name] = this.value || '';\r\n            }\r\n        });\r\n        return o;\r\n    };\r\n\r\n\r\n\r\n    // Desktop / mobile elements detach / attach\r\n    $('header').on(\"webkitTransitionEnd transitionend oTransitionEnd\", function (event) {\r\n        if (event.originalEvent.propertyName == \"min-height\") {\r\n            moveElements();\r\n        }\r\n    });\r\n    moveElements();\r\n    function moveElements(){\r\n        var women = $('.js-dropdown-women'),\r\n            men = $('.js-dropdown-men'),\r\n            navigation = $('.js-pages'),\r\n            filter = $('.sidebar-filter');\r\n        var screenSize = checkWindowWidth();\r\n\r\n        navigation.detach();\r\n        women.detach();\r\n        men.detach();\r\n        filter.detach();\r\n\r\n        if ( screenSize ) {\r\n            //desktop screen\r\n            navigation.insertAfter('.nav-catalog');\r\n            women.prependTo('.js-women-desktop');\r\n            men.prependTo('.js-men-desktop');\r\n            filter.prependTo('.sidebar');\r\n\r\n        } else {\r\n            //mobile screen\r\n            women.appendTo('.js-women-mobile');\r\n            men.appendTo('.js-men-mobile');\r\n            navigation.insertAfter('.js-pages-mobile');\r\n            filter.appendTo('#sidebar-filters');\r\n        }\r\n    }\r\n    function checkWindowWidth() {\r\n        var mq = window.getComputedStyle(document.querySelector('header'), '::before').getPropertyValue('content').replace(/\"/g, '').replace(/'/g, \"\");\r\n        return (mq != 'mobile');\r\n    }\r\n    var sidebarOpened = false;\r\n    // Toggle active on filter or navigation open\r\n    $(\".js-toggle-sidebar\").click(function(){\r\n        var $this = $(this),\r\n            target = $this.data('target'),\r\n            active = $this.hasClass('active');\r\n        if(sidebarOpened) {\r\n            closeSidebar();\r\n            if(!active) {\r\n                setTimeout(function() {\r\n                    openSidebar($this, target);\r\n                }, 500);\r\n            }\r\n        }\r\n        else {\r\n            openSidebar($this, target);\r\n        }\r\n    });\r\n    function closeSidebar() {\r\n        $('.js-sidebar-open').removeClass('active');\r\n        $('.js-nav-visible').removeClass('active');\r\n        $('.js-filter-visible').removeClass('active');\r\n        setTimeout(function() {\r\n            $('.js-toggle-sidebar').removeClass('active');\r\n        }, 300);\r\n        sidebarOpened = false;\r\n    }\r\n    function openSidebar($this, target) {\r\n        setTimeout(function() {\r\n            $this.addClass('active');\r\n        }, 300);\r\n        $(target).addClass('active');\r\n        $('.js-sidebar-open').addClass('active');\r\n        sidebarOpened = true;\r\n    }\r\n\r\n    // Product detailed image carousel\r\n    $(\"#js-product-gallery-nav\").carousel({\r\n        vertical : true,\r\n        margin: 0,\r\n        responsive: {\r\n            xl: {items: 5, options: {margin: 0, vertical: true}},\r\n            lg: {items: 5, options: {margin: 0, vertical: true}},\r\n            md: {items: 5, options: {margin: 0, vertical: true}},\r\n            sm: {items: 5, options: {margin: 0, vertical: false}},\r\n            xs: {items: 3, options: {margin: 0, vertical: false}}\r\n        }\r\n    });\r\n\r\n    //Product set carousel\r\n    $(\"#js-product-set\").carousel();\r\n\r\n    // Product seen carousel\r\n    $(\".js-product-carousel\").carousel();\r\n\r\n    // Main page banners slider\r\n    $(\"#js-main-banner\").carousel({\r\n        margin: 0,\r\n        pagination: true,\r\n        responsive: {\r\n            xl: 1,\r\n            lg: 1,\r\n            md: 1,\r\n            sm: 1,\r\n            xs: 1\r\n        }\r\n    });\r\n\r\n    // Load VK comments widget\r\n    $(\".js-vk-comments-widget\").on('click.vk',function() {\r\n        $(this).off('click.vk');\r\n        $.getScript(\"//vk.com/js/api/openapi.js?145\", function() {\r\n            VK.init({apiId: 4411901, onlyWidgets: true});\r\n            VK.Widgets.Comments(\"js-vk_comments\", {limit: 5, attach: false});\r\n        });\r\n    });\r\n\r\n    // Checkout steps\r\n    $body.on('click', '.js-step-next', function(e) {\r\n        e.preventDefault();\r\n        nextStep($(this));\r\n    });\r\n\r\n\r\n    // Delivery price calc\r\n    $body.on('click', '.js-delivery', function(e) {\r\n        var $this = $(this),\r\n            total = $(\".js-total\"),\r\n            delivery = parseInt($this.find('.js-price').data('price')),\r\n            newTotal = parseInt(total.data('amount')) + delivery;\r\n        total.text(number_format(newTotal, 0, '.', ' ') + ' ₽');\r\n    });\r\n\r\n    // Order submit click\r\n    $body.on('click', '#js-order-submit', function(e) {\r\n        e.preventDefault();\r\n        var form = $(this).closest('form');\r\n        formSubmit(form);\r\n    });\r\n\r\n    // Play youtube video\r\n    $body.on(\"click\", \".js-play-video\", function(e) {\r\n        e.preventDefault();\r\n        var $this = $(this),\r\n            parent = $this.parent(),\r\n            iframe = parent.find('iframe');\r\n        parent.addClass(\"active\");\r\n        iframe.attr(\"src\", iframe.data('src'));\r\n    });\r\n\r\n    // Ajax form submit\r\n    function formSubmit(form) {\r\n        var url = form.attr('action'),\r\n            postData = form.serialize(),\r\n            requiredFields = form.find('.js-required-fields');\r\n        if( formValid(requiredFields, true) ) {\r\n            $.post(url, postData, function(data){\r\n                // Exception\r\n                if(typeof data.error !== 'undefined'){\r\n                    console.log(data.message);\r\n                }\r\n                // Do some action\r\n                if(typeof data.action !== 'undefined'){\r\n                    var fn = window[data.action];\r\n                    if(typeof fn === 'function') {\r\n                        fn(data);\r\n                    }\r\n                }\r\n            },'json');\r\n        }\r\n    }\r\n    $body.on('submit', \".js-form-ajax\", function(e){\r\n        e.preventDefault();\r\n        formSubmit($(this));\r\n    });\r\n\r\n    $body.on('click', '.js-cart-submit', function(e) {\r\n        var $this = $(this),\r\n            is_fast = $this.data('is_fast');\r\n        document.getElementById('is_fast').value = is_fast;\r\n        if(is_fast) {\r\n            e.preventDefault();\r\n            formSubmit($this.closest('form'));\r\n        }\r\n\r\n    });\r\n\r\n    // Form validate\r\n    function formValid(fields, errors) {\r\n        if(typeof fields === 'undefined')\r\n            return false;\r\n\r\n        if(typeof errors === 'undefined')\r\n            errors = false;\r\n\r\n        var checked = 0;\r\n        fields.each(function(index, el) {\r\n            if(el.name == 'phone') {\r\n                if( el.value.length > 14 ) {\r\n                    checked++;\r\n                    $(el).removeClass('error');\r\n                }\r\n                else {\r\n                    if(errors)\r\n                        $(el).addClass('error');\r\n                }\r\n            }\r\n            else {\r\n                if(el.value && el.value.length > 1) {\r\n                    checked++;\r\n                    $(el).removeClass('error');\r\n                }\r\n                else {\r\n                    if(errors)\r\n                        $(el).addClass('error');\r\n                }\r\n            }\r\n        });\r\n        return checked == fields.length;\r\n    }\r\n\r\n    // Quantity change\r\n    $body.on('click', '.js-quantity', function() {\r\n        var $this = $(this),\r\n            num = parseInt($this.data('num')),\r\n            $input = $this.parent().find('.js-quantity-input'),\r\n            quantity = parseInt($input.val()),\r\n            sum = quantity + num;\r\n        if(  sum > 0 ) {\r\n            $input.val(sum);\r\n        }\r\n        if(typeof $this.data('submit') !== 'undefined') {\r\n            $this.closest('form').submit();\r\n        }\r\n        else {\r\n            updateCartSums($this);\r\n        }\r\n    });\r\n    var timer;\r\n    $body.on('keyup' ,'.js-quantity-input', function() {\r\n        clearTimeout(timer);\r\n        var $this = $(this);\r\n        timer = setTimeout(function(){\r\n            if(typeof $this.data('submit') !== 'undefined') {\r\n                $this.closest('form').submit();\r\n            }\r\n            else {\r\n                updateCartSums($this);\r\n            }\r\n        },1000)\r\n    });\r\n    function updateCartSums($this) {\r\n        var product = $this.closest('.js-product'),\r\n            price = parseInt(product.find('.js-price').data('price')),\r\n            cnt = parseInt(product.find('.js-quantity-input').val()),\r\n            amount = product.find('.js-amount'),\r\n            total = $('.js-total-amount'),\r\n            newAmount = price * cnt,\r\n            dif = newAmount - parseInt(amount.data('amount')),\r\n            newTotal = parseInt(total.data('total') + dif);\r\n        amount.data('amount', newAmount);\r\n        amount.text(number_format(newAmount, 0, '.', ' ') + '₽');\r\n        total.data('total', newTotal);\r\n        total.text(number_format(newTotal, 0, '.', ' ') + '₽');\r\n    }\r\n\r\n    // Do some action by ajax\r\n    $body.on('click', '.js-action-link', function(e) {\r\n        e.preventDefault();\r\n        var url = $(this).data('action');\r\n        var post_data = $(this).data();\r\n        delete post_data['action'];\r\n        $.get(url, post_data, function(data) {\r\n            // Exception\r\n            if(typeof data.error !== 'undefined'){\r\n                console.log(data.message);\r\n            }\r\n            // Do some action\r\n            if(typeof data.action !== 'undefined'){\r\n                var fn = window[data.action];\r\n                if(typeof fn === 'function') {\r\n                    fn(data);\r\n                }\r\n            }\r\n        });\r\n    });\r\n    // Mask phone\r\n    $('.js-phone').mask(\"+7 000 000 00 000\", {placeholder: \"+7 ___ ___ __ __\"});\r\n\r\n    // Check required fields\r\n    $body.on('input', '.js-required-fields', function(e) {\r\n        var fields = $('.js-required-fields');\r\n        if( formValid(fields) ) {\r\n            $('.js-step-next').attr('disabled', false);\r\n        }\r\n        else{\r\n            $('.js-step-next').attr('disabled', true);\r\n        }\r\n    });\r\n\r\n    // Product gallery thumbs switch\r\n    $body.on('click', '.js-gallery-thumb', function(e) {\r\n        var $this = $(this),\r\n            images = $('.js-gallery-big');\r\n        $('.js-gallery-thumb').removeClass('active');\r\n        $this.addClass('active');\r\n        images.removeClass('active');\r\n        images.eq($this.index()).addClass('active');\r\n    });\r\n\r\n});\r\n\r\n// Update cart widget\r\nfunction updateCart(data){\r\n    if(typeof data.count !== 'undefined') {\r\n        $(\".js-cart-quantity\").text(data.count);\r\n    }\r\n\r\n    if(typeof data.modal !== 'undefined') {\r\n        openModal(data);\r\n    }\r\n\r\n    if(typeof data.removed !== 'undefined') {\r\n        var product = $(\"[data-id=\" + data.removed + \"]\"),\r\n            total = $('.js-total-amount');\r\n        total.data('total', data.amount);\r\n        total.text(number_format(data.amount, 0, '.', ' ') + '₽');\r\n        product.remove();\r\n    }\r\n}\r\n\r\n// Next step, accepts element or number\r\nfunction nextStep($el) {\r\n    var step = $.isNumeric($el) ? $el : $el.data('next_step');\r\n    if(typeof step !== 'undefined') {\r\n        $(\".js-step\").removeClass('active');\r\n        $(\".js-step_\" + step).addClass('active');\r\n    }\r\n}\r\n\r\n// Show order success page\r\nfunction orderSuccess(data) {\r\n    // Show next step\r\n    $('#order-success').append(data.html);\r\n    nextStep(3);\r\n}\r\n\r\nfunction openModal(data) {\r\n    if(typeof data.modal !== 'undefined') {\r\n        $.fancybox.close();\r\n        $.fancybox.open([{\r\n                src : data.modal,\r\n                type : 'inline'\r\n            }],\r\n            {\r\n                closeBtn: false,\r\n                beforeClose : function( instance, current, e ) {\r\n                    var form = current.$slide.find('form');\r\n                    if(typeof form.data('submit-on-close') !== 'undefined'){\r\n                        form.submit();\r\n                    }\r\n                    if(typeof data.modalAction !== 'undefined'){\r\n                        if(data.modalAction == 'refresh-on-close')\r\n                            window.location = '/';\r\n                    }\r\n                }\r\n            });\r\n    }\r\n}\r\n\r\nfunction number_format( number, decimals, dec_point, thousands_sep ) {\t// Format a number with grouped thousands\r\n    //\r\n    // +   original by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)\r\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\r\n    // +\t bugfix by: Michael White (http://crestidg.com)\r\n\r\n    var i, j, kw, kd, km;\r\n\r\n    // input sanitation & defaults\r\n    if( isNaN(decimals = Math.abs(decimals)) ){\r\n        decimals = 2;\r\n    }\r\n    if( dec_point == undefined ){\r\n        dec_point = \",\";\r\n    }\r\n    if( thousands_sep == undefined ){\r\n        thousands_sep = \".\";\r\n    }\r\n\r\n    i = parseInt(number = (+number || 0).toFixed(decimals)) + \"\";\r\n\r\n    if( (j = i.length) > 3 ){\r\n        j = j % 3;\r\n    } else{\r\n        j = 0;\r\n    }\r\n\r\n    km = (j ? i.substr(0, j) + thousands_sep : \"\");\r\n    kw = i.substr(j).replace(/(\\d{3})(?=\\d)/g, \"$1\" + thousands_sep);\r\n    //kd = (decimals ? dec_point + Math.abs(number - i).toFixed(decimals).slice(2) : \"\");\r\n    kd = (decimals ? dec_point + Math.abs(number - i).toFixed(decimals).replace(/-/, 0).slice(2) : \"\");\r\n\r\n\r\n    return km + kw + kd;\r\n}\r\n//good review\r\n$('.product-review-form').on('submit', function(e) {\r\n    e.preventDefault();\r\n    var form = $(this);\r\n    $.post(form.attr('action'), form.serialize(), function(data) {\r\n        if(data.result === 'ok') {\r\n            var title = form.find('.form-success__title');\r\n            var body = form.find('.product-review-form__body');\r\n            body.children().css('display', 'none');\r\n            title.text('Спасибо, '+ form.get(0)['name'].value +'!');\r\n            body.find('.form-success').css('display', 'block');\r\n        } else {\r\n\r\n        }\r\n    });\r\n    return false;\r\n});\r\nfunction appendComments(data) {\r\n    var navigation = $('#product-reviews-navigation');\r\n    var btn_more = $('#product-reviews .btn_more:first');\r\n    var per_page = 5;\r\n    if(data['clear']) {\r\n        $('.product-review').remove();\r\n    }\r\n    if(data['count'] > 0) {\r\n        btn_more.data('page', data['next_page']);\r\n        if(data['count'] > per_page) {\r\n            data['count'] = per_page;\r\n        }\r\n        btn_more.find('.count').text('(' + data['count'] + ')');\r\n    }else {\r\n        navigation.hide();\r\n    }\r\n    navigation.before(data['html']);\r\n}\r\n\r\nfunction appendGoods(data) {\r\n    var $goods_block = $('#js-goods');\r\n    var $navigation = $('.page-navigation');\r\n    var $btn_more = $navigation.find('.btn_more');\r\n    if(data['nextPage']) {\r\n        $btn_more.data('page', data['nextPage']);\r\n        $btn_more.find('.count').text('(' + data['count'] + ')');\r\n    } else {\r\n        $navigation.remove();\r\n    }\r\n    if(data['clear']) {\r\n        $goods_block.text('');\r\n    }\r\n    $goods_block.append(data['html']);\r\n}\r\n\r\n\r\n"]}